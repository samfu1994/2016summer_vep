<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.box {
  font: 10px sans-serif;
}

.box line,
.box rect,
.box circle {
  fill: #fff;
  stroke: #000;
  stroke-width: 1.5px;
}

.box .center {
  stroke-dasharray: 3,3;
}

.box .outlier {
  fill: none;
  stroke: #ccc;
}

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="box.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>

var margin = {top: 10, right: 50, bottom: 20, left: 50},
    width = 120 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var min = [],
    max = [];

var chart = d3.box()
    .whiskers(iqr(1.5))
    .width(width)
    .height(height);
    
d3.csv("ubiq1.csv", function(error, csv) {
  if (error) throw error;

  Object.size = function(obj) {
    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }
    return size;
  };
    
  var refer = [];
  var index = 0;
  for(var x in csv[1]){
     if(!isNaN(csv[1][x])){
         refer[index] = [];
         max[index] = -Infinity;
         min[index] = Infinity;
         index++;
     } 
  }
    
  var label = csv[0];
  csv.splice(0, 1);
    
  console.log(csv);

  for(var row in csv){
      index = 0;
      console.log("aaaaaaa");
      for(var ele in csv[row]){
          var tmp = csv[row][ele];
          if(!isNaN(tmp)){
              refer[index].push(tmp);
              if (tmp > max[index]) max[index] = tmp;
              if (tmp < min[index]) min[index] = tmp;
              index++;
          }
      }
  }
  console.log(min);
  console.log(max);
  console.log(refer);
//  chart.domain([min, max]);
  var svg = d3.select("body").selectAll("svg")
      .data(refer)
    .enter().append("svg")
      .attr("class", "box")
      .attr("width", function(d, i){
//                                    chart.domain([min[i], max[i]]);
                                    return width + margin.left + margin.right; })
      .attr("height", height + margin.bottom + margin.top)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .call(chart);

});


// Returns a function to compute the interquartile range.
function iqr(k) {
  return function(d, i) {
    var q1 = d.quartiles[0],
        q3 = d.quartiles[2],
        iqr = (q3 - q1) * k,
        i = -1,
        j = d.length;
    while (d[++i] < q1 - iqr);
    while (d[--j] > q3 + iqr);
    return [i, j];
  };
}

</script>
